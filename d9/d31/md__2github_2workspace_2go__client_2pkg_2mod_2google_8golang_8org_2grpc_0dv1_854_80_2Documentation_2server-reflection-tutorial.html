<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ResilientDB: gRPC Server Reflection Tutorial</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">ResilientDB<span id="projectnumber">&#160;v1.3.1</span>
   </div>
   <div id="projectbrief">NexRes</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/d31/md__2github_2workspace_2go__client_2pkg_2mod_2google_8golang_8org_2grpc_0dv1_854_80_2Documentation_2server-reflection-tutorial.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">gRPC Server Reflection Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md105"></a> gRPC Server Reflection provides information about publicly-accessible gRPC services on a server, and assists clients at runtime to construct RPC requests and responses without precompiled service information. It is used by <a href="https://github.com/fullstorydev/grpcurl">gRPCurl</a>, which can be used to introspect server protos and send/receive test RPCs.</p>
<h1><a class="anchor" id="autotoc_md106"></a>
Enable Server Reflection</h1>
<p>gRPC-go Server Reflection is implemented in package <a href="https://github.com/grpc/grpc-go/tree/master/reflection">reflection</a>. To enable server reflection, you need to import this package and register reflection service on your gRPC server.</p>
<p>For example, to enable server reflection in <code>example/helloworld</code>, we need to make the following changes:</p>
<div class="fragment"><div class="line">--- a/examples/helloworld/greeter_server/main.go</div>
<div class="line">+++ b/examples/helloworld/greeter_server/main.go</div>
<div class="line">@@ -40,6 +40,7 @@ import (</div>
<div class="line">        &quot;google.golang.org/grpc&quot;</div>
<div class="line">        pb &quot;google.golang.org/grpc/examples/helloworld/helloworld&quot;</div>
<div class="line">+       &quot;google.golang.org/grpc/reflection&quot;</div>
<div class="line"> )</div>
<div class="line"> </div>
<div class="line"> const (</div>
<div class="line">@@ -61,6 +62,8 @@ func main() {</div>
<div class="line">        }</div>
<div class="line">        s := grpc.NewServer()</div>
<div class="line">        pb.RegisterGreeterService(s, &amp;pb.GreeterService{SayHello: sayHello})</div>
<div class="line">+       // Register reflection service on gRPC server.</div>
<div class="line">+       reflection.Register(s)</div>
<div class="line">        if err := s.Serve(lis); err != nil {</div>
<div class="line">                log.Fatalf(&quot;failed to serve: %v&quot;, err)</div>
<div class="line">        }</div>
</div><!-- fragment --><p>An example server with reflection registered can be found at <code>examples/features/reflection/server</code>.</p>
<h1><a class="anchor" id="autotoc_md107"></a>
gRPCurl</h1>
<p>After enabling Server Reflection in a server application, you can use gRPCurl to check its services. gRPCurl is built with Go and has packages available. Instructions on how to install and use gRPCurl can be found at <a href="https://github.com/fullstorydev/grpcurl#installation">gRPCurl Installation</a>.</p>
<h1><a class="anchor" id="autotoc_md108"></a>
Use gRPCurl to check services</h1>
<p>First, start the helloworld server in grpc-go directory:</p>
<div class="fragment"><div class="line">$ cd &lt;grpc-go-directory&gt;/examples</div>
<div class="line">$ go run features/reflection/server/main.go</div>
</div><!-- fragment --><p>output: </p><div class="fragment"><div class="line">server listening at [::]:50051</div>
</div><!-- fragment --><p>After installing gRPCurl, open a new terminal and run the commands from the new terminal.</p>
<p><b>NOTE:</b> gRPCurl expects a TLS-encrypted connection by default. For all of the commands below, use the <code>-plaintext</code> flag to use an unencrypted connection.</p>
<h2><a class="anchor" id="autotoc_md109"></a>
List services and methods</h2>
<p>The <code>list</code> command lists services exposed at a given port:</p>
<ul>
<li><p class="startli">List all the services exposed at a given port</p>
<div class="fragment"><div class="line">$ grpcurl -plaintext localhost:50051 list</div>
</div><!-- fragment --><p class="startli">output: </p><div class="fragment"><div class="line">grpc.examples.echo.Echo</div>
<div class="line">grpc.reflection.v1alpha.ServerReflection</div>
<div class="line">helloworld.Greeter</div>
</div><!-- fragment --></li>
<li><p class="startli">List all the methods of a service</p>
<p class="startli">The <code>list</code> command lists methods given the full service name (in the format of &lt;package&gt;.&lt;service&gt;).</p>
<div class="fragment"><div class="line">$ grpcurl -plaintext localhost:50051 list helloworld.Greeter</div>
</div><!-- fragment --><p class="startli">output: </p><div class="fragment"><div class="line">helloworld.Greeter.SayHello</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md110"></a>
Describe services and methods</h2>
<ul>
<li><p class="startli">Describe all services</p>
<p class="startli">The <code>describe</code> command inspects a service given its full name (in the format of &lt;package&gt;.&lt;service&gt;).</p>
<div class="fragment"><div class="line">$ grpcurl -plaintext localhost:50051 describe helloworld.Greeter</div>
</div><!-- fragment --><p class="startli">output: </p><div class="fragment"><div class="line">helloworld.Greeter is a service:</div>
<div class="line">service Greeter {</div>
<div class="line">  rpc SayHello ( .helloworld.HelloRequest ) returns ( .helloworld.HelloReply );</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli">Describe all methods of a service</p>
<p class="startli">The <code>describe</code> command inspects a method given its full name (in the format of &lt;package&gt;.&lt;service&gt;.&lt;method&gt;).</p>
<div class="fragment"><div class="line">$ grpcurl -plaintext localhost:50051 describe helloworld.Greeter.SayHello</div>
</div><!-- fragment --><p class="startli">output: </p><div class="fragment"><div class="line">helloworld.Greeter.SayHello is a method:</div>
<div class="line">rpc SayHello ( .helloworld.HelloRequest ) returns ( .helloworld.HelloReply );</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md111"></a>
Inspect message types</h2>
<p>We can use the <code>describe</code> command to inspect request/response types given the full name of the type (in the format of &lt;package&gt;.&lt;type&gt;).</p>
<ul>
<li><p class="startli">Get information about the request type</p>
<div class="fragment"><div class="line">$ grpcurl -plaintext localhost:50051 describe helloworld.HelloRequest</div>
</div><!-- fragment --><p class="startli">output: </p><div class="fragment"><div class="line">helloworld.HelloRequest is a message:</div>
<div class="line">message HelloRequest {</div>
<div class="line">  string name = 1;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md112"></a>
Call a remote method</h2>
<p>We can send RPCs to a server and get responses using the full method name (in the format of &lt;package&gt;.&lt;service&gt;.&lt;method&gt;). The <code>-d &lt;string&gt;</code> flag represents the request data and the <code>-format text</code> flag indicates that the request data is in text format.</p>
<ul>
<li><p class="startli">Call a unary method</p>
<div class="fragment"><div class="line">$ grpcurl -plaintext -format text -d &#39;name: &quot;gRPCurl&quot;&#39; \</div>
<div class="line">  localhost:50051 helloworld.Greeter.SayHello</div>
</div><!-- fragment --><p class="startli">output: </p><div class="fragment"><div class="line">message: &quot;Hello gRPCurl&quot;</div>
</div><!-- fragment --> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
